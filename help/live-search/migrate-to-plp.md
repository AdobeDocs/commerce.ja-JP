---
title: 検索アダプタから PLP ウィジェットへの移行
description: 非推奨の検索アダプターから製品一覧表示ページウィジェットに移行する方法  [!DNL Live Search]  説明します。
source-git-commit: 8811f0f271928fbc827e5a0164542da473c57224
workflow-type: tm+mt
source-wordcount: '2053'
ht-degree: 0%

---

# 検索アダプタから PLP ウィジェットへの移行

検索アダプタは [&#x200B; 4.0.0 の時点で &#x200B;](release-notes.md#live-search-400) 非推奨 [!DNL Live Search] となり、セキュリティアップデートのみが提供されます。 [&#x200B; 製品リストページ（PLP）ウィジェット &#x200B;](plp-styling.md) は、今後のすべての [!DNL Live Search] 実装でサポートされるソリューションです。 このガイドは、移行が簡単な場合や、追加の作業が必要な場合に役立ちます。

## 前提条件

移行プロセスを開始する前に、お使いの環境がこれらの要件を満たしていることを確認します。

移行を開始する前に、以下を行います。

**技術的要件**:

- Adobe Commerce 2.4.4 以降。
- [!DNL Live Search] 拡張機能がインストールされました。
- コマンドライン（CLI）にアクセスします。
- Commerce管理者にアクセスします。
- テスト用のステージングまたは QA 環境。

**バックアップと準備**:

1. データベースとコードをバックアップします。
1. 現在のカスタマイズを文書化します。
1. [&#x200B; 境界と制限 &#x200B;](boundaries-limits.md) をレビューして、PLP ウィジェットがニーズを満たしていることを確認します。
1. トラフィックが少ない時間帯に移行をスケジュールします。
1. ストアフロントの行動に対して変更が加えられる可能性があることを関係者に通知します。

**現在の実装を確認します**。

- 現在の [!DNL Live Search] バージョンを確認します。
- 使用されているファセットとその設定をドキュメント化します。
- すべての検索機能をテストし、期待される動作を文書化します。
- 現在の検索結果プレゼンテーションのスクリーンショットをキャプチャします。

**バージョン互換性**:

- Adobe Commerce 2.4.4 以降を実行している。
- [!DNL Live Search] 4.0.0 以降へのアップグレードの準備ができました。

## 移行シナリオ

### 簡単な移行（追加作業は不要）

実装が次のすべての条件を満たしている場合は、PLP ウィジェットに直接移行できます。

**標準 Luma ベースのストアフロント**:

- Luma テーマまたは Luma から継承されたテーマを最小限のカスタマイズで使用しています。
- PLP レイアウトまたはテンプレートにカスタム変更を加えていません。
- 検索結果とやり取りするカスタム JavaScript拡張機能を作成していません。

**標準製品カタログ**:

- すべての製品属性では、（カスタムソースモデルではなく）標準ソースモデルを使用します。
- 特別なレンダリングロジックを必要とするカスタム製品タイプはありません。
- カタログでは、標準のファセットとフィルタリングのみを使用します。

**標準の統合**:

- Analytics にGoogle Tag Manager （GTM）を使用していない。
- 検索動作を変更するサードパーティの拡張機能を使用していない。

実装がこれらの条件に一致する場合は、[&#x200B; 標準の移行手順 &#x200B;](#standard-migration-steps) に進みます。

### 追加作業が必要な移行

実装に次のいずれかが含まれる場合は、追加作業が必要です。

**カスタムテーマの変更**:

- Luma テンプレートを上書きするカスタム PLP レイアウト。
- 検索アダプタ固有の要素を対象とするカスタム CSS またはJavaScript。
- PLP または関連ファイルへのカスタム テンプレートの変更。
- テーマが Luma から継承されない（例えば、カスタムテーマを最初から継承する）。

**カスタム製品属性**:

- ファセットとして使用されるカスタムソースモデルを持つ製品属性。
- 特別な表示要件を持つカスタム製品タイプ。
- `"is_user_defined": false` を使用したプログラム属性。

**高度な統合**:

- Google Tag Manager （GTM）は、トラッキングに積極的に使用されています。
- 検索と統合されたサードパーティの分析またはパーソナライゼーションツール。
- カスタムイベントトラッキングまたはデータレイヤーの実装。
- 外部検索またはレコメンデーションエンジンとの統合。

**ヘッドレスまたはPWAの実装**:

- ヘッドレスアーキテクチャを使用（例：PWA Studio、Vue ストアフロント）。
- カスタムフロントエンドフレームワーク（React、Vue、Angular）。
- カタログクエリにのみGraphQLを使用する。
- カスタムストアフロントイベントの実装。

**カスタムウィジェットコード**:

- 以前は、検索アダプターコードをカスタマイズしていました。
- 独自の CDN でウィジェットのカスタムバージョンをホストする。
- 検索機能のためのカスタム JavaScript拡張機能。

実装にこれらのシナリオがある場合は、[&#x200B; 複雑な移行シナリオ &#x200B;](#complex-migration-scenarios) を参照してください。

## 標準の移行手順

特別なカスタマイズを行わない実装の場合は、次の手順に従います。

### 手順 1:[!DNL Live Search] のアップグレード

PLP ウィジェットにアクセスするには、[!DNL Live Search] 拡張機能をバージョン 4.0 以降にアップグレードします。

**役割**：販売員またはパートナー

1. 現在の [!DNL Live Search] のバージョンを確認します。

   ```bash
   composer show magento/live-search | grep version
   ```

1. バージョン 3.x 以前の場合、アップグレードの前に AdvancedSearch モジュールを有効化します：

   ```bash
   bin/magento module:enable Magento_AdvancedSearch
   ```

1. `composer.json` 4.0 以降を必要とするように [!DNL Live Search] を更新する：

   ```json
   "require": {
      "magento/live-search": "^4.0"
   }
   ```

1. アップグレードを実行します。

   ```bash
   composer update magento/live-search --with-dependencies
   ```

1. セットアップのアップグレードと再コンパイルを実行します。

   ```bash
   bin/magento setup:upgrade
   bin/magento setup:di:compile
   ```

1. 必要に応じて、静的コンテンツをデプロイします。

   ```bash
   bin/magento setup:static-content:deploy
   ```

### 手順 2:PLP ウィジェットを有効にする

Commerce Admin で PLP ウィジェットを設定します。

**役割**: マーチャント

[!DNL Live Search] 4.0.0 以降の新規インストールでは、PLP ウィジェットはデフォルトで有効になっています。 以前のバージョンからアップグレードする場合：

1. **[!UICONTROL Stores]**/設定/**[!UICONTROL Configuration]** に移動します。
1. **[!UICONTROL Live Search]**/**[!UICONTROL Storefront Features]** に移動します。
1. 「**[!UICONTROL Storefront Features]**」セクションを展開します。
1. **[!UICONTROL Enable Product Listing Widgets]** を **はい** に設定します。
1. 「**[!UICONTROL Save Config]**」をクリックします。
1. キャッシュをフラッシュします（**[!UICONTROL System]**/ツール/**[!UICONTROL Cache Management]**/**[!UICONTROL Flush Magento Cache]**）。

### 手順 3：ステージングでテストする

運用開始前に、実稼動以外の環境での移行を検証します。

**役割**：マーチャント/パートナー

実稼動環境にデプロイする前に、検索機能のテストを十分に行います。

**機能テスト**:

- 検索結果が正しく表示されることを確認します。
- 設定済みのすべてのファセットをテストします。
- カテゴリナビゲーションが機能することを確認します。
- 結果によるページネーションをテストします。
- 並べ替えオプションが期待どおりに機能することを確認します。
- シンプルな製品に対して、買い物かごへの追加機能のテストを行います。

**ビジュアルテスト**:

- 製品画像が正しく表示されていることを確認します。
- 製品名と価格が正しく表示されていることを確認します。
- カラースウォッチをテストします（使用する場合）。
- モバイルデバイスでのレスポンシブ動作を確認します。
- スタイル設定がブランドと一致することを確認します。

**パフォーマンステスト**:

- ページの読み込み時間を測定します。
- 現実的なカタログサイズでテストします。
- サーバーリソースの使用状況を監視します。
- ブラウザーコンソールでJavaScript エラーを確認します。

### 手順 4：実稼動環境へのデプロイ

検証済みの設定をライブのストアフロントに移動します。

**役割**：マーチャント/パートナー

1. 可能な場合は、メンテナンスウィンドウ中にデプロイメントをスケジュールします。
1. 標準のデプロイメントプロセスに従います。
1. [&#x200B; 手順 2:PLP ウィジェットを有効にする &#x200B;](#step-2-enable-the-plp-widget) を使用して、実稼動環境で PLP ウィジェットを有効にします。
1. デプロイメント直後の問題を監視します。
1. 重大な問題が発生した場合は、ロールバック計画を準備します。

### 手順 5：検証と監視

移行後の検索パフォーマンスとカスタマーエクスペリエンスを追跡する。

**役割**: マーチャント

デプロイメント後、主要指標を監視します。

- 結果ゼロの検索率
- 検索から買い物かごへのコンバージョン率
- ページ読み込みのパフォーマンス
- お客様からのフィードバックまたはサポートチケット
- ブラウザーコンソールのJavaScript エラー

## 複雑な移行シナリオ

次のシナリオでは、標準の移行手順を超えた追加の計画、カスタム開発または特別なサポートが必要になります。

### レイアウトを変更したカスタムテーマ

このシナリオでは、デフォルトの製品リストの動作を上書きするカスタムテンプレートまたはレイアウトを使用します。

**役割**：開発者/パートナー

1. **監査のカスタマイズ**:
   - テーマ内のすべてのカスタムレイアウト XML ファイルを文書化します。
   - 製品リストページや関連ファイルに対して行ったカスタムテンプレートの変更を確認します。
   - スタイル設定に使用するカスタム CSS クラスを識別します。
   - カスタム JavaScript インタラクションを文書化する。

1. **CSS ベースのカスタマイズへの移行**:
   - PLP ウィジェットは特定の CSS クラスを使用します（『 [PLP スタイルガイド &#x200B;](plp-styling.md) を参照）。
   - PLP ウィジェットの CSS クラスを使用してビジュアルカスタマイズを再作成します。
   - カスタムスタイルが正しく適用されることをテストします。

1. **競合するカスタマイズの削除**:
   - 商品リスト構造を変更するレイアウト XML を削除します。
   - 検索アダプタ固有の要素を対象とするJavaScriptをクリーンアップします。
   - 更新テンプレートは、ウィジェットのレンダリングと競合するテンプレートを上書きします。

1. **徹底的にテスト**:
   - すべてのビジュアルのカスタマイズが PLP ウィジェットで機能することを確認します。
   - レイアウトの競合を回避します。
   - すべてのブレークポイントとデバイスでテストします。

### カスタムソースモデルを使用した製品属性

このシナリオでは、検索アダプターではサポートされていないが PLP ウィジェットではサポートされているカスタムソースモデルの製品属性を使用するファセットが存在します。

**役割**：マーチャント（管理者設定）

1. **影響を受ける属性を特定**:
   - ファセットとして使用される製品属性の確認
   - カスタムソースモデルを使用するコンポーネントを特定します。
   - 現在のファセット設定をドキュメント化します。

1. **PLP ウィジェットをアップグレードして有効にする**:
   - [&#x200B; 標準の移行手順 &#x200B;](#standard-migration-steps) に従います。
   - PLP ウィジェットは、カスタムソースモデル属性をサポートします。

1. **ファセットの再設定**:
   - **[!UICONTROL Marketing]**/SEO と検索/**[!UICONTROL Live Search]** に移動します。
   - 影響を受ける属性のファセット設定を確認します。
   - テストファセットは、カスタムソースモデルで正しく機能します。

1. **検証**:
   - カスタムソースモデルファセットを使用してフィルタリングをテストします。
   - すべての属性値が正しく表示されていることを確認します。
   - パフォーマンスが許容可能であることを確認します。

### Google Tag Manager （GTM）統合

このシナリオでは、PLP ウィジェットを有効にすると GTM が失敗する可能性がある既知の問題があります。

**役割**：開発者/パートナー+顧客エンジニアリング

**オプション 1：検索アダプターを続行する（暫定のみ）**

- GTM がビジネスクリティカルな場合は、検索アダプターを有効にしておきます。
- セキュリティの更新のみを受け取ることを理解する。
- GTM の互換性が解決したら、移行を計画します。
- GTM の互換性の更新については、Adobe サポートにお問い合わせください。

**オプション 2:GTM トラッキングを代替アプローチに移行**

1. **カスタムイベントコレクションの実装**:

   - [&#x200B; ストアフロントイベントSDK](https://developer.adobe.com/commerce/services/shared-services/storefront-events/) を使用します。
   - 検索および製品インタラクションイベントをキャプチャします。
   - イベントを GTM データレイヤーに手動でプッシュします。

1. **次の手順を実行します**。

   - 現在の GTM トラッキング要件を監査します。
   - GTM イベントを Storefront イベントにマッピングします。
   - カスタムイベントリスナーの実装
   - GTM へのデータフローをテストします。
   - 分析レポートを検証します。

**オプション 3:GTM をAdobe Analyticsに置き換える**

- 該当する場合は [0&rbrace;Adobe Analytics&rbrace; への移行を検討してください。](https://business.adobe.com/jp/products/adobe-analytics.html)
- サポートが必要な場合は、カスタマーエンジニアリングにお問い合わせください。

**問い合わせ先**:GTM 互換性の更新またはカスタマーエンジニアリングサポートのサポートチケットを送信します。

### シナリオ：ヘッドレスまたはPWAの実装

このシナリオでは、カスタムイベントの収集を必要とするヘッドレスまたはPWA ストアフロントがあり、標準の PLP ウィジェット UI を使用できません。

**役割**：開発者/パートナー

1. **リファレンス実装の確認**:
   - [PLP ウィジェットのソースコード &#x200B;](https://github.com/adobe/storefront-product-listing-page) を調べます。
   - [[!DNL Live Search] GraphQL](graphql.md) の API ドキュメントを確認してください。
   - [&#x200B; カタログサービスクエリ &#x200B;](https://developer.adobe.com/commerce/webapi/graphql/schema/catalog-service/) について

1. **カスタム UI の実装**:
   - クエリ [!DNL Live Search] は、GraphQL API を使用します。
   - カスタム製品リストコンポーネントの作成
   - ファセット用の UI の実装
   - ページネーションと並べ替えを処理します。

1. **イベント収集の実装**:
   - [&#x200B; ストアフロントイベントのドキュメント &#x200B;](https://developer.adobe.com/commerce/services/shared-services/storefront-events/#live-search) を確認します。
   - 必要なイベントを実装します。
      - `search-request-sent`
      - `search-response-received`
      - `search-results-view`
      - `product-page-view`
      - `add-to-cart`
   - テストイベントデータがAdobe Commerceに送られます。

1. **ファセットの並べ替えを設定**:
   - ヘッドレス実装の場合、ファセットはカウントで並べ替えることができます。
   - **[!UICONTROL Live Search]**/**[!UICONTROL Facets]** Workspace でを設定します。
   - UX を向上させるには、**[!UICONTROL Sort Type]** を **Count** に設定します。

1. **テストと検証**:
   - 検索結果の正確性を検証します。
   - ファセット機能をテストします。
   - イベントが正しくトラッキングされていることを確認します。
   - パフォーマンス指標を監視します。
   - インテリジェントマーチャンダイジング機能の動作の検証

### シナリオ：カスタムウィジェットコードの変更

このシナリオでは、検索アダプタまたはウィジェットコードを以前にカスタマイズ済みで、カスタマイズを移行する必要があります。

**役割**：開発者/パートナー

1. **既存のカスタマイズのドキュメント化**:
   - 検索アダプタに対して行われたすべてのカスタマイズを一覧表示します。
   - 各カスタマイズを推進するビジネス要件を特定します。
   - カスタマイズがまだ必要かどうかを確認します。

1. **組み込み機能がニーズを満たしているかどうかを確認します**。
   - [PLP ウィジェットの機能 &#x200B;](plp-styling.md#widget-features) を確認します。
   - CSS ベースのカスタマイズで十分かどうかを確認します。
   - PLP ウィジェットのデフォルト動作のテスト。

1. **カスタムコードがまだ必要な場合**:
   - [PLP ウィジェットリポジトリ &#x200B;](https://github.com/adobe/storefront-product-listing-page) のクローンを作成します。
   - カスタマイズを実装します。
   - 独自の CDN でホストする。
   - カスタムウィジェットを使用するように、Commerce設定を更新します。

   >[!WARNING]
   >
   >リポジトリのコードを使用して PLP ウィジェットをカスタマイズした場合、メンテナンスと更新はユーザーが担当します。 Adobeの新しい PLP ウィジェット機能は、カスタマイズとの互換性がない可能性があります。

1. **徹底的にテスト**:
   - すべてのカスタム機能のテスト。
   - Commerceの更新によってカスタマイズが中断されないことを確認します。
   - カスタム実装を文書化します。
   - 継続的なメンテナンスを計画します。

## 既知の制限とエッジケース

移行する際は、次の制限事項に注意してください。

**PLP ウィジェットの制限**:

- **並べ替え順序の方向**:PLP ウィジェットが有効な場合、製品リストページの並べ替え順序の方向を変更できません（昇順/降順）。
- **買い物かごに追加**:「買い物かごに追加」ボタンは、ウィジェットのシンプルな製品でのみ使用できます。
- **階層の価格**:PLP ウィジェットではサポートされていません。
- **VAT 表示**：価格には VAT が含まれていますが、VAT を別の値として表示することはできません。

**検索アダプターとの機能の違い**:

- **カラースウォッチ**：スウォッチを正しく機能させるには、`color` 属性のスペルを（「カラー」やカスタム名ではなく） `color` とまったく同じにする必要があります。
- **テーマのスタイル設定**：カスタムテーマクラスはウィジェットには継承されません。ウィジェット固有の CSS クラスをターゲットにする必要があります。
- **カスタム製品タイプ**：ウィジェットではサポートされていません。

**パフォーマンスの考慮事項**:

- 大きなカタログ（50,000 以上の製品）の場合、最初のページの読み込みに時間がかかることがあります。
- 多くの値を持つ複数のファセットがパフォーマンスに影響を与える可能性があります。
- モバイルデバイスのパフォーマンスは、カタログサイズによって異なる場合があります。

**互換性の問題**:

- Google Tag Manager の互換性の問題（「[GTM シナリオ &#x200B;](#google-tag-manager-gtm-integration)」を参照）。
- 一部のサードパーティの拡張機能は、PLP ウィジェットと競合する場合があります。
- カスタムチェックアウトの拡張機能では、アップデートが必要になる場合があります。

## ヘルプ

具体的なニーズに基づいて適切なリソースに問い合わせます。

**Adobe サポート** は、次の点で役立ちます。

- 標準の Live Search 移行手順
- PLP ウィジェット設定の問題
- ファセットまたは属性のインデックス作成の問題
- デフォルト実装のパフォーマンスの問題
- アップグレードエラー

**開発パートナー/システムインテグレーター** には、次の点について連絡してください。

- カスタムテーマの変更
- カスタムウィジェットコードの実装
- サードパーティの拡張機能の互換性
- ヘッドレスまたはPWAの実装
- カスタムイベントトラッキング

Adobe サポートに問い合わせる方法については、[&#x200B; ヘルプセンターユーザーガイド &#x200B;](https://experienceleague.adobe.com/ja/docs/commerce-knowledge-base/kb/help-center-guide/magento-help-center-user-guide) を参照してください。

## FAQ

検索アダプターから PLP ウィジェットへの移行に関するよくある質問への回答を示します。

**Q：検索アダプタはバグ修正または機能アップデートを受け取りますか？**

回答：いいえ。 検索アダプターは非推奨で、セキュリティ更新プログラムのみを受け取ります。 バグの修正、パフォーマンスの向上、新機能は、PLP ウィジェットでのみ使用できます。 検索アダプタで問題が発生した場合は、PLP ウィジェットへの移行をお勧めします。

**Q：移行によってストアフロントが混乱しますか？**

A：ステージングで適切なテスト手順に従っている場合は、移行はシームレスに行われます。 実稼動デプロイメントに対応するロールバックプランを準備します。

**Q：移行にはどのくらいの時間がかかりますか？**

A：標準実装の場合：1～2 時間。 カスタム実装の場合：複雑さに応じて 1～4 週間。

**Q：検索マーチャンダイジングルールは引き続き機能しますか？**

A：はい。[!DNL Live Search] ワークスペースで設定したすべての検索マーチャンダイジングルール、シノニムおよびファセットは、引き続き PLP ウィジェットで機能します。

**Q：ファセットを再設定する必要がありますか？**

A：通常は使用できませんが、検索アダプターでカスタムソースモデル属性によって制限されていた場合は、PLP ウィジェットで使用できるようになりました。

**Q：カスタム CSS はどうですか？**

A: PLP ウィジェットクラスをターゲットにするには、CSS を更新する必要があります。 [CSS クラスのリファレンス &#x200B;](plp-styling.md#css-classes) を参照してください。

**Q：検索パフォーマンスに影響はありますか？**

A: PLP ウィジェットはパフォーマンスを向上させるように設計されています。 ほとんどのマーチャントは、同等またはそれ以上のパフォーマンスを見ています。 大きなカタログはステージングでテストする必要があります。
